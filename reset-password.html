<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reset Password</title>
    <style>
        body { font-family: Arial, sans-serif; display: flex; justify-content: center; align-items: center; height: 100vh; }
        form { display: flex; flex-direction: column; width: 300px; }
        input { margin-bottom: 10px; padding: 8px; }
        button { padding: 10px; background-color: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background-color: #0056b3; }
        .error { color: red; margin-top: 5px; }
        .success { color: green; margin-top: 5px; }
    </style>
</head>
<body>

    <form id="resetForm">
        <input type="hidden" id="resetToken" name="token">
        <input type="password" id="newPassword" placeholder="Enter new password" required>
        <button type="submit">Reset Password</button>
        <div id="resetError" class="error"></div>
        <div id="resetSuccess" class="success"></div>
    </form>

    <script>
        // âœ… Set API base URL for deployed backend
        const API_BASE = 'https://https://chat3080.onrender.com/'; // <-- replace with your actual deployed backend URL

        // Get token from URL and put it in hidden input
        const urlParams = new URLSearchParams(window.location.search);
        const token = urlParams.get('token');
        if (token) {
            document.getElementById('resetToken').value = token;
        }

        // Handle reset form submission
        document.getElementById('resetForm').addEventListener('submit', async (e) => {
            e.preventDefault();

            const newPassword = document.getElementById('newPassword').value;
            const token = document.getElementById('resetToken').value;
            const errorDiv = document.getElementById('resetError');
            const successDiv = document.getElementById('resetSuccess');

            try {
                const response = await fetch(`${API_BASE}/auth/reset-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ token, newPassword })
                });

                const data = await response.json();

                if (response.ok) {
                    successDiv.textContent = data.message;
                    errorDiv.textContent = '';
                } else {
                    errorDiv.textContent = data.error;
                    successDiv.textContent = '';
                }
            } catch (err) {
                errorDiv.textContent = 'Network error. Please try again.';
                successDiv.textContent = '';
            }
        });
    </script>

</body>
</html>
